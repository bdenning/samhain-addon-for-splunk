[samhain]
# Remove the start of file [SOF] marker because it doesn't have a timestamp.
SEDCMD-remove-sof = s/^\[SOF\]$//

# Extracted fields
EXTRACT-msg = msg=<(?P<msg>[^>]+)
EXTRACT-file_hash = chksum_new=<(?P<file_hash>[^>]+)
EXTRACT-object_path,object = path=<(?P<object_path>(\/[^ ]+\/)|\/(?!\/[^ ]+\/))(?P<object>[^>]*)>
EXTRACT-file_size = size_new=<(?P<file_size>[^>]+)>
EXTRACT-file_create_time = ctime_new=<\[(?<file_create_time>[^\]]+)
EXTRACT-file_access_time = atime_new=<\[(?<file_access_time>[^\]]+)
EXTRACT-file_modify_time = mtime_new=<\[(?<file_modify_time>[^\]]+)
EXTRACT-file_acl = mode_new=<(?P<file_acl>[a-z-]+)>

# Calaculated fields
EVAL-dest = host
EVAL-file_path = object_path
EVAL-file_name = if(object=="/", object, object_path . object)
EVAL-change_type = "filesystem"
EVAL-object = if(object_path=="/" AND isnull(object), "/", object)
EVAL-action = case(msg=="POLICY MISSING", "deleted", msg=="POLICY ADDED", "created", match(msg, "POLICY \[\w+\] --------T-"), null, match(msg, "POLICY \[\w+\] [CLDIH-]{5}[^MUG]{3}T[S-]"), "modified", match(msg, "POLICY \[\w+\] -----[MUG-]{3}T-"), "acl_modified")

# TODO: https://github.com/bdenning/samhain-addon-for-splunk/issues/1
EVAL-object_category = "file"
